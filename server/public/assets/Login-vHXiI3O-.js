import{r as l,u as j,j as o,s as v}from"./index-DJc1edfh.js";const L=()=>{const[c,i]=l.useState(!1),[e,u]=l.useState(null),[d,m]=l.useState(!1),[r,h]=l.useState({}),[n,g]=l.useState(null),f=j();l.useEffect(()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{const{latitude:a,longitude:s}=t.coords;g({latitude:a,longitude:s})},t=>{console.error("Error fetching location: ",t)}):console.error("Geolocation is not supported by this browser.")},[]);const p=async()=>{if(!n){console.error("Location not available. Cannot make API call.");return}i(!0);const s=await(await fetch("http://localhost:5000/admin/login",{method:"POST",headers:{"Content-Type":"application/json",Latitude:n.latitude,Longitude:n.longitude},body:JSON.stringify(r)})).json();u(s),m(s.success),i(!1)},x=async()=>{if(!n){console.error("Location not available. Cannot make API call.");return}i(!0);const s=await(await fetch("http://localhost:5000/admin/verifyOtp",{method:"POST",headers:{"Content-Type":"application/json",Latitude:n.latitude,Longitude:n.longitude},body:JSON.stringify(r)})).json();u(s),v("token",s.token,1),s.code===200&&f("/admin/dashboard"),s.code===403&&m(!1),i(!1)},b=t=>{if(t.preventDefault(),!n){alert("Location not available. Please allow location access.");return}d?x():p()};return o.jsx("main",{className:"login max-width",children:o.jsxs("form",{onSubmit:b,className:c?"loading":"",children:[o.jsxs("div",{className:"inputField",children:[o.jsx("label",{htmlFor:"email",children:"Email"}),o.jsx("input",{type:"email",required:!0,value:r.email||"",onChange:t=>h(a=>({...a,email:t.target.value})),placeholder:"Enter Your Email"})]}),d&&o.jsxs("div",{className:"inputField",children:[o.jsx("label",{htmlFor:"otp",children:"Enter Otp"}),o.jsx("input",{type:"text",required:!0,value:r.otp||"",maxLength:6,pattern:"^[0-9]{6}$",onChange:t=>h(a=>({...a,otp:t.target.value})),placeholder:"Enter Otp"})]}),(e==null?void 0:e.message)&&o.jsxs("p",{className:`msg ${(e==null?void 0:e.code)===200&&"success"}`,children:[e==null?void 0:e.message,e!=null&&e.attemptLeft?`(${e==null?void 0:e.attemptLeft} attempts left)`:""]}),o.jsx("button",{type:"submit",disabled:c,children:(e==null?void 0:e.code)!==200?"Submit":"Verify OTP"})]})})};export{L as default};
